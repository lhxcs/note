# 概论

## 什么是 Internet

- 从具体构成角度
    - 节点
        - 主机及其上运行的应用程序
        - 路由器、交换机等网络交换设备
    - 边：通信链路
        - 接入网链路：主机连接到互联网的链路
        - 主干链路：路由器间的链路
    - 协议：控制发送、接收消息
        - 协议定义了在两个或多个通信实体之间交换的报文格式和次序，以及在报文传输和/或接收或其它事件方面所采取的动作。
        - 如 TCP、IP、HTTP、FTP
    - 数以亿计的、互联的计算设备
        - 主机 = 端系统 （端系统通过通信链路和分组交换机连接到一起）
        - 运行网络应用程序
    - 通信链路
        - 光纤、同轴电缆、无线电、卫星
        - 传输速率 = 带宽(bps)
    - 分组交换设备：转发分组(pockets)
        - 端系统之间发送数据时，发送端系统将其数据分成一段一段，然后加上必要的信息后形成一个个的数据包，这个数据包称作分组。
        - 分组交换机从它的一条入链路接收分组，并且选择一条出链路将分组转发出去。
        - 路由器和交换机
    - Internet "网络的网络"
        - 松散的层次结构，互连的 ISP（Internet Service Provider）
    - Internet 标准
        - RFC: Request for comments
        - IEIF: INternetengineering Task Force
- 从服务角度：分布式应用+提供服务的基础设施
    - 使用通信设施进行通信的分布式应用。
    - 通信基础设施为 apps 提供编程接口(通信服务)
  
## 网络边缘

- 网络结构
    - 网络边缘：主机、应用程序(客户端和服务器)
    - 网络核心：互连着的路由器、网络的网络
    - 接入网、物理媒体：有线或者无线通信链路。

主机划分成客户端 (clinet) 和服务器 (server)。

### 接入网

考虑了位于网络边缘的应用程序和端系统之后，我们来考虑接入网。接入网是指将端系统物理连接到其边缘路由器的网络。

- 边缘路由器是端系统到任何其它远程端系统的路径上的第一台路由器。

### 物理媒体

我们考虑一个比特从一个端系统开始传输，通过一系列链路和路由器，到达另一个端系统。这个比特通过一系列发射器-接收器对，从源向目的地传输。对于每个发射器-接收器对，通过跨越一种物理媒体传播电磁波或光脉冲来发送比特。

- 导引型媒体
    - 固体：光缆、双绞铜线
- 非导引型媒体
    - 无线局域网等

## 网络核心

### 分组交换

在各种网络应用中，端系统彼此交换报文（message）。为了从源端系统向目的端系统发送一个报文，源将长报文划分为较小的数据块，称之为分组(packet)。在源和目的地之间，每个分组都通过通信链路和分组交换机传送。

- 存储转发传输
    - 在交换机能够开始向输出链路传输该分组的第一个比特之前，必须接收到整个分组。
- 排队时延和分组丢失
    - 每台分组交换机有多条链路与之相连。对于每条相连的链路，该分组交换机具有一个**输出缓存**(output buffer), 也称为输出队列，它用于存储路由器准备发往那条链路的分组。
    - 因此，除了存储转发时延外，分组还需要承受输出缓存的排队时延(queuning delay)。
    - 这些时延是变化的，变化的程度取决于网络的拥挤程度。
    - 由于缓存空间大小是有限的，一个到达的分组可能发现该缓存已经被其它等待传输的缓存占满了，这种情况就会出现分组丢失(packet loss)（丢包）,到达的分组或者已经排队的分组之一将被丢弃。
- 转发表和路由选择协议
    - 路由器要如何决定它应当向哪条链路进行转发呢？
    - 因特网中，每个端系统具有一个称为 IP 地址的地址。当源主机要向目的端系统发送一个分组时，源在该分组的首部包含了目的地的 IP 地址。
    - 每个路由器有一个转发表(forwarding table),用于将目的地址映射称为输出链路。
    - 当某分组到达一台路由器时，路由器检查该地址，并用这个目的地址搜索其转发表，以发现适当的出链路。
    - 但是我们要怎么设置转发表呢？
    - 因特网有一些特殊的路由选择协议(routing protocal) 用于自动设置这些转发表。(一个路由选择协议可以决定从每台路由器到每个目的地的最短路径，并用这些最短路径来配置路由器中的转发表)

### 电路交换

电路交换网络中，在端系统间通信会话期间，预留了端系统间沿路径通信所西药的资源(缓存，链路传输速率)。在分组交换网络中，这些资源不是预留的，会话的报文按需使用这些资源，其后果可能是得排队接通信线路。

- 电路交换网络的复用
    - 链路中的电路是通过频分复用(frequency-division multiplexing, FDM) 或时分复用 (TDM) 来实现的
    - TDM： 将时间划分为固定区间的帧，每个帧被划分为固定数量的时隙。当网络跨越一条链路创建一条连接时，网络在每个帧中为该连接指定一个时隙。这些时隙专门由该连接单独使用。
    - FDM：链路的频谱由跨越链路创建的所有连接共享，在连接期间链路为每条连接专用一个频段。该频段的宽度称为带宽
### 网络的网络

端系统经过一个接入 ISP 与因特网相连，该接入 ISP 能够提供有线或无线连接。

为了理解因特网的网络结构，我们以逐步递进的方式构造一系列网络结构。

互联接入 ISP 的中心目标，是使所有端系统能够彼此发送分组。

- 网络结构1: 用单一的全球传输 ISP 互联所有接入 ISP。可以理解为全球传输 ISP 是一个由路由器和通信链路构成的网络，该网络跨越全球而且至少具有一台路由器靠近数十万接入 ISP 中的每一个。
- 网络结构2:由数十万接入 ISP 和多个全球传输 ISP 组成。这要求全球传输 ISP 之间必须是互联的。
- 网络结构3: 没有哪个 ISP 是无处不在的，在给定的区域我们应该有一个区域 ISP， 区域中的接入 ISP 与之连接。每个区域 ISP 则与第一层 ISP 连接（类似于全球传输 ISP）
- 网络结构4: 
  - Point of Prensence(PoP): 存在于除了底层接入 ISP 等级之外的所有层次。一个 PoP 是提供商网络中的一台或多台路由器群组，客户 ISP 能够与提供商 ISP 连接。
  - 任何 ISP 可以选择多宿，即可以与两个或更多提供商 ISP 连接。这样即使提供商之一出现故障，仍然能够继续发送和接收分组。
  - 对等：位于相同等级结构层次的一对邻近 ISP 能够直接将它们的网络连接，它们之间流量经直接连接而不是经过上游的中间 ISP 传输。
- 网络结构5: 在网络结构 4 的顶部增加内容提供商网络。内容提供商构建自己的网络，并且通过与较低层 ISP 对等而绕过较高层因特网 ISP，并且内容提供商对端用户也有更多的控制

## 时延、丢包和吞吐量

### 时延

- 类型
    - 处理时延：检查分组首部和决定该分组导向何处所需要的时间。
    - 排队时延：分组在链路上等待传输时经受排队时延。一个特定分组的排队时延长度取决于先期到达的正在排队等待向链路传输的分组数量。
    - 传输时延：假定分组以先到先服务方式传输（仅当所有已经到达的分组被传输后才能传输刚到达的分组）。用 $L$ 比特表示该分组的长度，用 $R$ bps 表示从路由器 A 到路由器 B 的链路传输速率。传输时延是 $\frac{L}{R}$.
    - 传播时延：该链路的起点到路由器传播所需要的时间。
        - 传输时延是路由器推出分组所需要的时间，与两台路由器之间的距离无关
        - 传播时延与分组长度或链路传输速率无关。